<h1>Finalisation de la réservation</h1>

<div id="reservation-section" data-room-id="<%= @room.id %>">
  <!-- Contenu de la section de réservation -->
</div>

<!-- Formulaire pour finaliser la réservation -->
<%= form_with(model: [@room, @booking], local: true, id: "booking-form") do |f| %>

  <div class="form-group">
    <%= f.label :start_date, "Date de début" %>
    <%= f.date_select :start_date, default: @booking.start_date || (params[:start_date].present? ? params[:start_date].to_date : nil), id: "start-date" %>
  </div>

  <div class="form-group">
    <%= f.label :end_date, "Date de fin" %>
    <%= f.date_select :end_date, default: @booking.end_date || (params[:end_date].present? ? params[:end_date].to_date : Date.today), id: "end-date" %>
  </div>

  <!-- Champs pour le sélecteur de date et d'heure -->
  <div class="form-group">
    <label for="date-select">Sélectionner une date</label>
    <input type="date" id="date-select" class="form-control">
  </div>

  <div class="form-group">
    <label for="time-select">Sélectionner une heure</label>
    <input type="time" id="time-select" class="form-control">
  </div>

  <!-- Autres champs de formulaire -->
  <div class="form-group">
    <%= f.label :first_name, 'Prénom' %>
    <%= f.text_field :first_name, class: 'form-control', value: @booking.first_name %>
  </div>

  <div class="form-group">
    <%= f.label :last_name, 'Nom' %>
    <%= f.text_field :last_name, class: 'form-control', value: @booking.last_name %>
  </div>

  <div class="form-group">
    <%= f.label :email, 'Adresse Email' %>
    <%= f.email_field :email, class: 'form-control', value: @booking.email %>
  </div>

  <div class="form-group">
    <%= f.label :phone, 'Numéro de téléphone' %>
    <%= f.telephone_field :phone, class: 'form-control', value: @booking.phone %>
  </div>

  <div class="form-group">
    <%= f.label :address, 'Adresse' %>
    <%= f.text_field :address, class: 'form-control', value: @booking.address %>
  </div>

  <div class="form-group">
    <%= f.submit 'Continuer vers le paiement', class: 'btn btn-primary', name: 'continue' %>
    <%= f.submit 'Demander un devis', class: 'btn btn-secondary', name: 'quote' %>
  </div>
<% end %>

<script>
  // Script pour insérer les dates sélectionnées dans les champs de date
  document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.getElementById('start-date');
    const endDateInput = document.getElementById('end-date');
    const dateSelectInput = document.getElementById('date-select');
    
    // Si des dates sont sélectionnées dans le calendrier, elles sont injectées dans les champs du formulaire
    const params = new URLSearchParams(window.location.search);
    const selectedStartDate = params.get('start_date');
    const selectedEndDate = params.get('end_date');

    if (selectedStartDate && selectedEndDate) {
      // Si des dates sont présentes dans l'URL, on les affecte aux champs correspondants
      startDateInput.value = selectedStartDate;
      endDateInput.value = selectedEndDate;
    }

    // On peut également configurer le champ "Sélectionner une date" pour affecter automatiquement les valeurs
    dateSelectInput.addEventListener('change', function() {
      startDateInput.value = dateSelectInput.value;
      endDateInput.value = dateSelectInput.value; // Ou selon la logique si c'est différent
    });
  });
</script>
