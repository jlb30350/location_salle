<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= content_for?(:meta_title) ? yield(:meta_title) : "Location de salles" %></title>
  <meta name="description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : "Trouvez la salle parfaite pour votre événement" %>">
  <%= yield(:canonical_link) if content_for?(:canonical_link) %>
  <%= yield(:og_tags) if content_for?(:og_tags) %>
  <meta name="robots" content="index, follow">
  
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbo-track': 'reload' %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>


  <style>
    #map { height: 400px; width: 100%; margin-top: 40px; }
    #search-container { margin: 30px 0; }
    #results-container { margin-top: 30px; }
  </style>
</head>

<body>
  <%= render 'shared/flash_messages' %>
  <%= render 'layouts/navigation' %>

  <div class="container mt-3">
  <form id="locationForm">
  <input type="text" id="locationInput" placeholder="Entrez un code postal ou une ville">
  <button type="submit">Positionner sur la carte</button>
  </form>

    <div id="map"></div>
    <div id="results-container"></div>
    
    <%= render 'shared/user_actions' %>

    <%= yield %>
  </div>

    <!-- JavaScript inclusions -->
 
  <%= javascript_include_tag 'https://code.jquery.com/jquery-3.5.1.min.js' %> <!-- Charger jQuery avant Bootstrap -->
  <%= javascript_include_tag 'https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js' %>
  <%= javascript_include_tag 'https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js' %>
 
  
  <script>
  let map;
let currentMarker; // Variable pour stocker le marqueur actuel

function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 46.603354, lng: 1.888334 }, // Coordonnées initiales centrées sur la France
        zoom: 6
    });
}

function centerMapOnLocation(location) {
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({ 'address': location }, function(results, status) {
        if (status === 'OK') {
            // Supprime le marqueur précédent s'il existe
            if (currentMarker) {
                currentMarker.setMap(null);
            }

            // Centre la carte sur la nouvelle localisation et ajoute un nouveau marqueur
            map.setCenter(results[0].geometry.location);
            currentMarker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
            });
        } else {
            alert('Geocode was not successful for the following reason: ' + status);
        }
    });
}

// Événement pour gérer la soumission du formulaire
document.getElementById('locationForm').addEventListener('submit', function(event) {
    event.preventDefault();
    var location = document.getElementById('locationInput').value;
    if (location) {
        centerMapOnLocation(location);
    }
});

</script>


  <!-- Utilisation de async et defer pour l'API Google Maps -->

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCA4aUHK_Zd40CQFJLr5VYF_HOfTT-hSGM&callback=initMap&libraries=places"></script>


</body>
</html>
