<!-- app/views/rooms/availability.html.erb -->

<div id="reservation-section" data-room-id="<%= @room.id %>">
  <h1>Disponibilités pour <%= @room.name %></h1>

  <%= month_calendar(events: @bookings) do |date, bookings| %>
    <div class="day">
      <% if bookings.any? %>
        <!-- Affichage du jour réservé -->
        <span class="reserved">Réservé</span>
      <% else %>
        <!-- Transformer chaque jour disponible en bouton cliquable -->
        <button class="btn btn-success available-day" data-date="<%= date %>">Disponible</button>
      <% end %>
    </div>
  <% end %>
</div>

<script>
  let startDate = null;
  let endDate = null;

  document.querySelectorAll('.available-day').forEach(function(button) {
    button.addEventListener('click', function() {
      const selectedDate = this.getAttribute('data-date');
      
      if (!startDate) {
        // Première sélection : début de la réservation
        startDate = selectedDate;
        this.classList.add('btn-primary');  // Ajout de style pour indiquer la sélection
        this.classList.remove('btn-success'); // Supprimer le style de disponibilité
      } else if (!endDate) {
        // Deuxième sélection : fin de la réservation
        endDate = selectedDate;
        this.classList.add('btn-primary');  // Ajout de style pour indiquer la sélection
        this.classList.remove('btn-success'); // Supprimer le style de disponibilité

        // Redirection vers la page de création de réservation
        const roomId = document.getElementById('reservation-section').getAttribute('data-room-id');
        const url = `/rooms/${roomId}/bookings/new?start_date=${startDate}&end_date=${endDate}`;
        window.location.href = url;
      }
    });
  });
</script>
